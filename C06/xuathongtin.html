<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Thông tin cá nhân</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"/>
  <style>
    body { background-color: #f3f4f6; }
    .hidden { display: none; }
    input:focus, select:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(99,102,241,0.3);
      border-color: #4f46e5;
    }
    .info-label { font-weight: 500; color: #4b5563; margin-bottom: 2px; }
  </style>
</head>
<body class="font-sans">

<div class="container mx-auto p-4 md:p-8 min-h-screen flex items-start justify-center">
  <div class="w-full max-w-2xl bg-white rounded-xl shadow-2xl p-6 md:p-10">

    <h1 class="text-3xl font-bold text-gray-800 mb-8 text-center border-b pb-3">
      <i class="fas fa-user-circle text-indigo-600 mr-2"></i> Thông tin cá nhân
    </h1>

    <!-- Hiển thị thông tin -->
    <div id="user-info" class="user-info space-y-4"></div>

    <!-- Form chỉnh sửa -->
    <div id="edit-form" class="hidden mt-8 space-y-3">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="info-label">Họ:</label>
          <input type="text" id="edit-firstname" class="w-full border rounded-lg p-2"/>
        </div>
        <div>
          <label class="info-label">Tên:</label>
          <input type="text" id="edit-lastname" class="w-full border rounded-lg p-2"/>
        </div>
      </div>

      <div>
        <label class="info-label">Giới tính:</label>
        <select id="edit-gender" class="w-full border rounded-lg p-2">
          <option value="">Chọn giới tính</option>
          <option value="Nam">Nam</option>
          <option value="Nữ">Nữ</option>
          <option value="Khác">Khác</option>
        </select>
      </div>

      <div>
        <label class="info-label">Email/Username (Không thể sửa):</label>
        <input type="text" id="edit-id" disabled class="w-full border rounded-lg p-2 bg-gray-100 cursor-not-allowed"/>
      </div>

      <div>
        <label class="info-label">Số điện thoại:</label>
        <input type="tel" id="edit-number" class="w-full border rounded-lg p-2"/>
      </div>

      <div>
        <label class="info-label">Địa chỉ:</label>
        <input type="text" id="edit-address" class="w-full border rounded-lg p-2"/>
      </div>

      <div class="flex gap-4 pt-6">
        <button id="save-btn" class="flex-1 bg-indigo-600 text-white py-3 rounded-lg hover:bg-indigo-700 font-semibold">
          <i class="fas fa-save mr-1"></i> Lưu thay đổi
        </button>
        <button id="cancel-btn" class="flex-1 bg-gray-300 text-gray-800 py-3 rounded-lg hover:bg-gray-400 font-semibold">
          <i class="fas fa-times-circle mr-1"></i> Hủy
        </button>
      </div>
    </div>

    <!-- Nút chỉnh sửa và quay lại -->
    <div class="flex flex-col md:flex-row gap-4 mt-8 pt-4 border-t">
      <button id="edit-btn" class="flex-1 bg-green-500 text-white py-3 rounded-lg hover:bg-green-600 font-semibold">
        <i class="fas fa-edit mr-1"></i> Sửa thông tin
      </button>
      <button id="back-btn" class="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600 font-semibold">
        <i class="fas fa-arrow-left mr-1"></i> Quay lại Trang chủ
      </button>
    </div>

  </div>
</div>

<script>
  // ==== LẤY DỮ LIỆU NGƯỜI DÙNG ====
  const currentUser = JSON.parse(localStorage.getItem("currentUser"));
  if (!currentUser) {
    alert("Vui lòng đăng nhập để xem thông tin!");
    window.location.href = "dangnhap.html";
  }

  const storageKey = currentUser.email || currentUser.username;
  let userData = JSON.parse(localStorage.getItem(storageKey)) || {
    password: currentUser.password || "123456",
    firstname: currentUser.firstname || "",
    lastname: currentUser.lastname || "",
    gender: currentUser.gender || "",
    email: currentUser.email || "",
    username: currentUser.username,
    number: currentUser.number || "",
    address: currentUser.address || ""
  };
  localStorage.setItem(storageKey, JSON.stringify(userData));

  const userInfoDiv = document.getElementById("user-info");
  const editForm = document.getElementById("edit-form");
  const editBtn = document.getElementById("edit-btn");
  const saveBtn = document.getElementById("save-btn");
  const cancelBtn = document.getElementById("cancel-btn");
  const backBtn = document.getElementById("back-btn");

  // ==== HIỂN THỊ THÔNG TIN ====
  function renderUserInfo() {
    userInfoDiv.innerHTML = `
      <div class="grid grid-cols-2 gap-4">
        <p><strong class="info-label">Họ tên:</strong></p>
        <p>${userData.firstname} ${userData.lastname}</p>
        <p><strong class="info-label">Giới tính:</strong></p>
        <p>${userData.gender || 'Chưa cập nhật'}</p>
        <p><strong class="info-label">Email/Username:</strong></p>
        <p>${userData.email || userData.username}</p>
        <p><strong class="info-label">Số điện thoại:</strong></p>
        <p>${userData.number || 'Chưa cập nhật'}</p>
        <p><strong class="info-label">Địa chỉ:</strong></p>
        <p>${userData.address || 'Chưa cập nhật'}</p>
      </div>
    `;
  }
  renderUserInfo();

  // ==== HIỂN THỊ FORM CHỈNH SỬA ====
  editBtn.addEventListener("click", () => {
    userInfoDiv.classList.add("hidden");
    editForm.classList.remove("hidden");
    editBtn.classList.add("hidden");
    backBtn.classList.add("hidden");

    document.getElementById("edit-firstname").value = userData.firstname;
    document.getElementById("edit-lastname").value = userData.lastname;
    document.getElementById("edit-gender").value = userData.gender;
    document.getElementById("edit-id").value = userData.email || userData.username;
    document.getElementById("edit-number").value = userData.number;
    document.getElementById("edit-address").value = userData.address;
  });

  // ==== LƯU THÔNG TIN ====
  saveBtn.addEventListener("click", () => {
    const firstname = document.getElementById("edit-firstname").value.trim();
    const lastname = document.getElementById("edit-lastname").value.trim();
    const gender = document.getElementById("edit-gender").value;
    const number = document.getElementById("edit-number").value.trim();
    const address = document.getElementById("edit-address").value.trim();

    if (!firstname || !lastname || !number || !address) {
      alert("Vui lòng nhập đầy đủ Họ, Tên, Số điện thoại và Địa chỉ!");
      return;
    }

    userData = { ...userData, firstname, lastname, gender, number, address };
    localStorage.setItem(storageKey, JSON.stringify(userData));
    localStorage.setItem("currentUser", JSON.stringify(userData));

    renderUserInfo();
    editForm.classList.add("hidden");
    userInfoDiv.classList.remove("hidden");
    editBtn.classList.remove("hidden");
    backBtn.classList.remove("hidden");

    alert("Cập nhật thông tin thành công!");
  });

  // ==== HỦY CHỈNH SỬA ====
  cancelBtn.addEventListener("click", () => {
    editForm.classList.add("hidden");
    userInfoDiv.classList.remove("hidden");
    editBtn.classList.remove("hidden");
    backBtn.classList.remove("hidden");
  });

  // ==== QUAY LẠI TRANG CHỦ ====
  backBtn.addEventListener("click", () => {
    window.location.href = "index.html";
  });
</script>

</body>
</html>
